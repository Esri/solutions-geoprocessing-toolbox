<?xml version="1.0"?>
<!-- 
 Build.xml
 Description: Ant script used to fetch and unzip dependent data from ArcGIS Online
 Requirements: Internet connectivity, Java JRE, Ant
 -->

<project name="DataDownloadAndConfiguration" basedir="." default="config">

  <!-- templatehome = defense-and-intel-toolbox -->
  <property name="dir.zipdir" value="./" />
  <property name="dir.environmentdatadir" value="./environment/data" />
  <property name="dir.commondatadir" value="./common/data" />
  

  <target name="config" depends="make_dirs,get_common_data,get_environment_data">
    <echo message="Gets All Dependent Data used by this template from ArcGIS Online" />
  </target>

  <!-- Create necessary folder structure (Github will not create empty folders) -->
  <target name="make_dirs">
    <echo message="No need to makedirs, unzip makes entire maps, data folders" />
    
  </target>


  <target name="get_common_data">
  <!-- Get and manage test data for Common tests only -->
    
    <!--Original toolbox data: 1ab069b8ed5749c083069289151fe127-->
    <get src="http://www.arcgis.com/sharing/content/items/1ab069b8ed5749c083069289151fe127/data"
      dest="${dir.zipdir}/defense-and-intel-analysis-toolbox-maps.zip" 
      verbose="true"
      usetimestamp="true"/>
    <unzip src="${dir.zipdir}/defense-and-intel-analysis-toolbox-maps.zip"
         dest="${dir.commondatadir}"/>
    
    <!--Original toolbox maps: b818862d16b0425a85e66747874f3a16-->
    <get src="http://www.arcgis.com/sharing/content/items/b818862d16b0425a85e66747874f3a16/data"
      dest="${dir.zipdir}/defense-and-intel-analysis-toolbox-data.zip" 
      verbose="true"
      usetimestamp="true"/>
    <unzip src="${dir.zipdir}/defense-and-intel-analysis-toolbox-data.zip"
         dest="${dir.commondatadir}"/>

    <!--Publishable Tasks geodatabase: 92e0592d385e471d8216823f9844182e -->
    <get src="http://www.arcgis.com/sharing/content/items/92e0592d385e471d8216823f9844182e/data"
      dest="${dir.zipdir}/PublishableTasksData.gdb.zip"
      usetimestamp="true"
      verbose="true"/>
    <unzip src="${dir.zipdir}/PublishableTasksData.gdb.zip"
    dest="${dir.commondatadir}/geodatabases"/>
  
  </target>
  
  <target name="get_environment_data">
  <!-- Get and manage test data for Environment tests only   -->
    
    <!--Topographic test folder: 2b0858c4331e488eb3bba3ddd7d701a7 -->
    <get src="http://www.arcgis.com/sharing/content/items/2b0858c4331e488eb3bba3ddd7d701a7/data"
    dest="${dir.zipdir}/Topographic.zip"
    verbose="true"
    usetimestamp="true"/>
    
    <unzip src="${dir.zipdir}/Topographic.zip"
    dest="${dir.environmentdatadir}" />
    
    <!--NetworkPrepData.gdb: 8624572e651a418bbdef664d2e3020a2 -->
    <get src="http://www.arcgis.com/sharing/content/items/8624572e651a418bbdef664d2e3020a2/data"
    dest="${dir.zipdir}/NetworkPrepData.gdb.zip"
    verbose="true"
    usetimestamp="true"/>
    
    <unzip src="${dir.zipdir}/NetworkPrepData.gdb.zip"
    dest="${dir.environmentdatadir}/geodatabases" />
    
  </target>
  
  <target name="get_data_operations_only">

    <!--Download operational environment sample data to Commmon and Environment-->
    <get src="http://downloads.esri.com/resources/defense/Operational_Environment.zip"
      dest="${dir.zipdir}/Operational_Environment.zip" 
      verbose="true"
      usetimestamp="true"/>
    
    <unzip src="${dir.zipdir}/Operational_Environment.zip"
         dest="${dir.commondatadir}/Operational_Environment"/>
    
    <unzip src="${dir.zipdir}/Operational_Environment.zip"
         dest="${dir.environmentdatadir}/Operational_Environment"/>

  </target>

  <!-- Delete All Data Folders and Datasets -->
  <!-- Normally only for testing from a clean configuration -->
  <target name="clean">

    <echo message="Warning: deleting data dirs (only do this if you mean it)" />
    <echo message="Deleting path: ${dir.commondatadir}/data" />
    <echo message="Deleting path: ${dir.commondatadir}/maps" />
    <echo message="Deleting path: ${dir.environmentdatadir}/data" />

    <delete dir="${dir.commondatadir}/data" />
    <delete dir="${dir.commondatadir}/maps" />
    <delete dir="${dir.environmentdatadir}/data" />

  </target>

  
  <target name="test">
    <echo message="Test" />
  </target>

  
</project>
